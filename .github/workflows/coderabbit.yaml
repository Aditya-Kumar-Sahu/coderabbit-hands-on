name: CodeRabbit CLI Review

on:
  push:
    branches:
      - '**'

jobs:
  coderabbit-review:
    name: AI Code Review
    runs-on: ubuntu-latest
    permissions:
      contents: read
      
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Required for diff analysis

      - name: Install CodeRabbit CLI
        run: |
          # Download and install the CLI
          curl -fsSL https://cli.coderabbit.ai/install.sh | sh
          
          # Add the installation path to the system PATH for this workflow run
          # Standard install location is usually ~/.coderabbit/bin
          echo "$HOME/.coderabbit/bin" >> $GITHUB_PATH

      - name: Run CodeRabbit Review
        env:
          CODERABBIT_API_KEY: ${{ secrets.CODERABBIT_API_KEY }}
        run: |
          # Run the review on the committed changes
          source ~/.bashrc && coderabbit review --plain --type committed --base-commit HEAD~1
